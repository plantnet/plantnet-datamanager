{{#modelEmpty}}
  <h3 class="page-title">
    Table view
  </h3>
  <p class="alert alert-info">
    This structure is empty. Add some modules first, or ask an administrator to do so.
  </p>
{{/modelEmpty}}

{{^modelEmpty}}
<h3 class="page-title">
  Table view for <span class="{{#isView}}view-name{{/isView}}{{^isView}}module-name{{/isView}}">{{name}}</span>
  {{#filter_name}} - Filter : <span class="filter-name">{{filter_name}}</span>{{/filter_name}}
</h3>

 <div class="btn-toolbar" data-spy="affix" data-offset="200">
  <div class="btn-group">
    <a title="Select or Unselect all rows on this page." class="btn has-tooltip" data-placement="bottom">
      <input class="toggle-all-cmd" type="checkbox">
    </a>
  </div>
  <!-- Need to be implemented -->
  <!-- 
  <div class="btn-group">
    <form id="tree-search" class="">
      <div class="input-prepend input-append">
        <span class="add-on"><i class="icon-dm-filter"></i></span>
        <input title="Filter entries in this module" name="q" 
            placeholder="Filter this data" 
            class="input-medium search-query has-tooltip" data-placement="bottom" type="text">
      </div>
    </form>
  </div>
   -->
  <div class="btn-group">
    <button title="Show details of the selected row. You can double-click on a row to show its details, too"
      class="view-doc-cmd btn has-tooltip btn-light-docs" data-placement="bottom">
      <i class="icon-dm-detail"></i>
    </button>
    <button title="Edit the selected row. You can hold Ctrl and double-click on a row to edit it, too"
      class="edit-doc-cmd btn has-tooltip btn-light-docs" data-placement="bottom">
      <i class="icon-dm-edit"></i>
    </button>
    {{#add_doc_possible}}
      <button title="Add a new doc to this module" class="add-doc-cmd btn has-tooltip btn-light-docs" data-placement="bottom">
    {{/add_doc_possible}}
    {{^add_doc_possible}}
      <button disabled title="You can't add docs to this module" class="btn has-tooltip" data-placement="bottom">
    {{/add_doc_possible}}
      <i class="icon-dm-add"></i>
    </button>
    <button class="btn has-tooltip compare-doc-cmd btn-light-docs" data-container="body" data-placement="bottom" 
        title="Compare selected docs">
      <i class="icon-dm-compare"></i>
    </button>
    <button title="Delete the selected row" class="delete-doc-cmd btn has-tooltip btn-danger" data-placement="bottom">
      <i class="icon-dm-delete"></i>
    </button>
  </div>

  <div class="btn-group">
    <button title="View revisions for one selected doc" class="view-revs-cmd btn has-tooltip" data-placement="bottom">
      <i class="icon-dm-revision"></i>
    </button>
  </div>

  <input type="hidden" id="mm-is-ref" value="{{isRef}}"/>

  {{#isRef}}
  <div class="btn-group">
    <button class="btn has-tooltip edit-syn-cmd" data-container="body" data-placement="bottom" 
        title="Add or edit synonyms for selected entry">
      <i class="icon-dm-synonym-add"></i>
    </button>
  </div>
  {{/isRef}}

  <div class="btn-group selections">
    <!-- Construct by selector -->
  </div>
  <div class="btn-group">
    <button class="export-csv-table-cmd btn has-tooltip"
        title="Export all rows from all pages. If you want to export a subgroup, create a selection then export it." 
        data-placement="bottom">
      <i class="icon-dm-module-export"></i>
    </button>
    <button  class="query-new-cmd btn has-tooltip"
        title="Create a new query based on this module."
        data-placement="bottom">
      <i class="icon-dm-query"></i>
    </button>
  </div>

  {{#has_column_attachs}}
    <div class="btn-group">
      <button type="button" class="btn has-tooltip show-images {{#show_images}}active{{/show_images}}" data-toggle="button"
        data-placement="bottom"
        title="Display attachments - warning: may require a lot of memory!">
        <i class="icon-dm-pictures"></i>
        <!-- Show images -->
      </button>
    </div>
  {{/has_column_attachs}}
</div>

{{#isView}}
  <p class="alert alert-info small-bottom-margin">
    <strong>Reference modi:</strong> <span class="module-name">{{modiName}}</span>
    <br/>
    Data are sorted and paginated based on this module instance.
  </p>
  <form class="small-bottom-margin form-inline">
    <label class="radio has-tooltip" data-placement="top"
      title="Each different value of the reference module will generate a line, values down in the hierarchy will be grouped">
      <input type="radio" name="group-view" class="group-view" value="true" {{#group}}checked="checked"{{/group}}/>
      Group data under reference module
    </label>
    <br/>
    <label class="radio has-tooltip" data-placement="top"
      title="If a colum contains the same value multiple times, it will be repeated on several lines">
      <input type="radio" name="group-view" class="group-view" value="false" {{^group}}checked="checked"{{/group}}/>
      Flatten data - one row per leaf
    </label>
  </form>
{{/isView}}


{{^has_rows}}
<p class="alert alert-info">
  You have no data
</p>
{{/has_rows}}
{{#has_rows}}
<table class="data table table-striped table-hover table-bordered">
  <thead>
    <tr>
      <th>&nbsp;</th>
      {{#hasParents}}
        <th>
          Parent
        </th>
      {{/hasParents}}
      {{#headers}}
        <th>
          <div class="header-container">
            {{#priority}}
            <a {{#enc_field}}
               class="header-sort" data-id="{{id}}" data-modi="{{modi}}" data-corder="{{corder}}" data-showimages="{{show_images}}" 
               data-encfield="{{enc_field}}" data-limit="{{limit}}" data-filter-id="{{filter_id}}" data-group="{{group}}"
               {{/enc_field}}>
              <span class="sort-{{class}} colunm-sort-order label has-tooltip" 
                  title="Column sort order: {{class}}ending. Click to invert order">
                {{priority}}
              </span>
            </a>
            <span class="cancel-sort">
              <a href="#/viewtable/{{id}}/{{modi}}/_id/{{limit}}/0/{{filter_id}}/{{group}}/{{show_images}}">
                <img src="img/icons/delete.png" alt="Cancel sort" class="has-tooltip" 
                  title="Click here to cancel sort"/>
              </a>
            </span>
            {{/priority}}
            {{^priority}}
              <a class="help-spot has-tooltip"
                title="Click on column name to sort{{^isView}}. Hold the Shift key to sort multiple columns at the same time{{/isView}}">
                ?
              </a>
            {{/priority}}
            <a {{#enc_field}}
               class="header-sort" data-id="{{id}}" data-modi="{{modi}}" data-corder="{{corder}}" data-showimages="{{show_images}}" 
               data-encfield="{{enc_field}}" data-limit="{{limit}}" data-filter-id="{{filter_id}}" data-group="{{group}}"
               {{/enc_field}}>
              <span class="has-tooltip" title="Field from module instance : {{long_label}}">
                {{label}}
              </span>
            </a>
          </div>
        </th>
      {{/headers}}
    </tr>
  </thead>

  <tbody>
    {{#rows}}
      <tr class="dblclick-listener">
        <td>
          <input type="checkbox" class="ck" value="{{_id}}"/>
        </td>
        {{#hasParents}}
          <td>
            {{parent}}
          </td>
        {{/hasParents}}
        {{#values}}
          <td>
            {{^has_attachments}}
              <div class="val" data-type="{{type}}"  title="{{header}}">
                {{#is_label}}
                  <i>
                {{/is_label}}
                {{#ref_id}}
                  <a class="ref-link{{#has_tooltip}} has-tooltip{{/has_tooltip}}"
                    {{#has_tooltip}} data-placement="top" title="{{tooltip}}"{{/has_tooltip}}
                    href="#/viewdoc/{{ref_id}}">
                {{/ref_id}}
                {{#is_url}}
                  <a href="{{value}}">
                {{/is_url}}

                {{value}}

                {{#is_url}}
                  </a>
                {{/is_url}}
                {{#ref_id}}
                  </a>
                {{/ref_id}}
                {{#is_label}}
                  </i>
                {{/is_label}}
              </div>
            {{/has_attachments}}
            
            {{^show_images}}
              {{#has_attachments}}
                {{attachments_names}}
              {{/has_attachments}}
            {{/show_images}}
            
            {{#show_images}}
              {{#has_attachments}}
                <ul class="thumbnails small-thumbnails no-bottom-margin">
                  {{#attachments}}
                    <li>
                      <div class="thumbnail small-thumbnail">
                        {{#is_image}}
                          <div class="has-tooltip" title="Click to open a viewer for image {{name}}.">
                            <a href="{{url}}" class="preview">
                              <img src="{{img_url}}" alt="Image : {{name}}"/>
                            </a>
                          </div>
                        {{/is_image}}
                        {{^is_image}}
                          <div class="has-tooltip" title="Click to open the file {{name}}.">
                            <a href="{{url}}" target="_blank">
                              <img class="file" src="img/icons/big-attachment.png" alt="File : {{name}}"/>
                            </a>
                          </div>
                          <p class="file-caption">
                            {{shortFn}}
                          </p>
                        {{/is_image}}
                      </div>
                    </li>
                  {{/attachments}}
                </ul>
              {{/has_attachments}}
            {{/show_images}}
          </td>
        {{/values}}
      </tr>
    {{/rows}}
  </tbody>
</table>
{{/has_rows}}

{{#show_pagination}}
<div class="pagination pagination-centered affix-bottom" data-offset-bottom="300" data-spy="affix">
  <ul>
    <li {{^prev}}class="disabled"{{/prev}}>
      <a {{#prev}}href="#/viewtable/{{id}}/{{modi}}/{{order}}{{sort}}/{{limit}}/{{skip}}/{{filter_id}}/{{group}}/{{show_images}}"{{/prev}}>
        « Previous
      </a>
    </li>
    {{#pagesBefore}}
    <li title="Go to page {{pn}}">
      <a href="#/viewtable/{{id}}/{{modi}}/{{order}}{{sort}}/{{limit}}/{{lskip}}/{{filter_id}}/{{group}}/{{show_images}}">
        {{pn}}
      </a>
    </li>
    {{/pagesBefore}}
    <li class="active">
      <span>
        <strong>
          {{page}}
        </strong>
      </span>
    </li>
    {{#pagesAfter}}
    <li title="Go to page {{pn}}">
      <a href="#/viewtable/{{id}}/{{modi}}/{{order}}{{sort}}/{{limit}}/{{lskip}}/{{filter_id}}/{{group}}/{{show_images}}">
        {{pn}}
      </a>
    </li>
    {{/pagesAfter}}
    <li {{^next}}class="disabled"{{/next}}> 
      <a {{#next}}href="#/viewtable/{{id}}/{{modi}}/{{order}}{{sort}}/{{limit}}/{{skip}}/{{filter_id}}/{{group}}/{{show_images}}"{{/next}}>
        Next » 
      </a>
    </li>
    <li class="pagination-info disabled">
      <span class="zero-padding pagination-count">
        {{#exactPagination}}
        Elements {{eltstart}} - {{eltend}} / <strong>{{total_rows}}</strong> on {{total_pages}} pages of 
        <select id="rows-per-page" class="input-mini">
          {{#rowsPerPage}}
          <option value="#/viewtable/{{id}}/{{modi}}/{{order}}{{sort}}/{{number}}/{{skip}}/{{filter_id}}/{{group}}/{{show_images}}" 
              {{#selected}}selected="selected"{{/selected}}>
            {{number}}
          </option>
          {{/rowsPerPage}}
        </select>
        rows.
        {{/exactPagination}}
        {{^exactPagination}}
          There are <strong>{{nb_rows}}</strong> elements on this page.
        {{/exactPagination}}
      </span>
    </li>
  </ul>
</div>
{{/show_pagination}}

{{/modelEmpty}}