<h3 class="page-title">View document</h3>

<div id="viewdoc-toolbar" class="btn-toolbar doc-toolbar" data-spy="affix" data-offset="300">

  <div class="btn-group">
    <button class="btn has-tooltip expand-all-cmd" data-placement="bottom" 
            title="Expand all documents">
      <i class="icon-dm-toggle-expand"></i>
    </button>
    <button class="collapse-all-cmd btn has-tooltip" data-placement="bottom" 
        title="Collapse all documents">
      <i class="icon-dm-toggle-collapse"></i>
    </button>
  </div>
  
  <div class="btn-group">
    <a title="Select or Unselect all docs on this page." class="btn has-tooltip" data-placement="bottom">
      <input class="toggle-all-cmd" type="checkbox">
    </a>
  </div>
  
  <div class="btn-group">
    <button class="btn edit-doc-cmd has-tooltip btn-light-docs" data-placement="bottom"
            title="Edit selected doc. You can hold Ctrl and double-click on a block's fields to edit the doc, too">
      <i class="icon-dm-edit"></i>
    </button>
    <button class="btn has-tooltip edit-attchs-cmd btn-light-docs" data-placement="bottom" title="Edit attachments for the selected entry">
      <i class="icon-dm-attachment"></i>
    </button>
    <button id="dropdown-add-doc" class="btn dropdown-toggle has-tooltip add-doc-cmd btn-light-docs" data-container="body"
            data-toggle="dropdown" title="Add a new subdoc to the selected entry">
      <i class="icon-dm-add"></i>
      <span class="caret"></span>
    </button>
    <ul class="dropdown-menu submodis" role="menu" aria-labelledby="dopdown-add-doc">
      <!-- Content generated by selectors -->
    </ul>
    <button class="btn has-tooltip compare-doc-cmd btn-light-docs" data-container="body" data-placement="bottom" 
            title="Compare selected docs">
      <i class="icon-dm-compare"></i>
    </button>
    {{#is_writer}}
    <button class="btn has-tooltip delete-doc-cmd btn-danger" data-placement="bottom" title="Delete selected entries and subdocs">
      <i class="icon-dm-delete"></i>
    </button>
    {{/is_writer}}
  </div>
  
  {{#isRef}}
  <div class="btn-group">
    <button class="btn has-tooltip edit-syn-cmd" data-container="body" data-placement="bottom"
            title="Add or edit synonyms for selected entry">
      <i class="icon-dm-synonym-add"></i>
    </button>
    <button title="Show linked docs for selected docs" class="show-linked-docs-cmd btn has-tooltip" data-placement="bottom">
      <i class="icon-dm-docs-linked"></i>
    </button>
  </div>
  {{/isRef}}
  
  <div class="btn-group">
    <button class="btn has-tooltip show-images-cmd" data-placement="bottom" title="Show the pictures associated to the selected entry">
      <i class="icon-dm-pictures"></i>
    </button>
    <button class="btn has-tooltip show-map-cmd" data-placement="bottom" title="Show the map for the selected entry">
      <i class="icon-dm-map"></i>
    </button>
    <button class="btn has-tooltip show-revisions-cmd" data-placement="bottom" title="View revisions of the selected entry">
      <i class="icon-dm-revision"></i>
    </button>
  </div>
  <div class="btn-group selections">
    <!-- Construct by selector -->
  </div>
</div>

{{#docs}}
<div id="{{anchorId}}" class="doc-container" data-indent="{{level}}">
  <div class="doc-header doc-color" style="border-bottom:4px solid {{color}};">
    <input class="ck pull-left" type="checkbox" data-parent-id="{{parent_id}}" data-level="{{level}}" value="{{_id}}" 
           {{#withattchs}} data-attchs="true" {{/withattchs}} data-modi="{{modi}}" data-mm-id="{{mm_id}}"
           {{#hasGeoloc}} data-label="{{label}}" data-lonlat="{{geoloc}}" {{/hasGeoloc}}/>
    
    <button type="button" class="btn pull-right toggle-cmd" data-toggle="collapse" data-target="#doc-data-{{anchorId}}">
      &#9650;
    </button>
    <h4 class="viewdoc-title">
      <a class="has-tooltip" href="#/viewdoc/{{_id}}" title="Uniq ID: {{uid}}">
        {{modname}}{{#label}} : <span class="doc-label">{{label}}{{/label}}</span>
      </a>
    </h4>
  </div>
  <div id="doc-data-{{anchorId}}" class="collapse in">
    <div class="doc-inner">
      <div class="embedded-thumbnails">
        {{#withattchs}}
        <ul class="thumbnails low-padding-thumbnails">
          <li>
            <div class="dropbox dropbox-inline" data-id="{{_id}}" data-rev="{{_rev}}">
              <div class="drop-label muted has-tooltip" data-placement="right"
                   title="Drop files (images, pdf...) here to attach them to the document">
                Drop files here...
              </div>
              </div>
          </li>
          {{#attachments}}
          <li>
            {{#is_image}}
            <div class="thumbnail has-overlap">
              <div class="has-tooltip" data-placement="bottom" title="Click to open a viewer for image {{name}}.">
                <a href="{{url}}" target="_blank" class="preview">
                  <img src="{{img_url}}" alt="Image : {{name}}"/>
                </a>
                    </div>
              {{#fn}}
              <a class="overlap-cmd" href="http://localhost:5990/{{fn}}">
                <i class="icon-dm-pictures-original"></i>
                original
              </a>
              {{/fn}}
            </div>
            {{/is_image}}
            {{^is_image}}
            <div class="thumbnail">
              <div class="has-tooltip" data-placement="bottom" title="Click to open the file {{name}}.">
                <a href="{{url}}" target="_blank">
                  <img class="file" src="img/icons/big-attachment.png" alt="file : {{name}}"/>
                </a>
              </div>
              <p class="caption muted file-caption">
                {{shortFn}}
              </p>
            </div>
            {{/is_image}}
          </li>
          {{/attachments}}
        </ul>
        {{/withattchs}}
      </div>
      
      <div class="doc-data">
        <table class="table small-bottom-margin">
          <tbody>
            {{#data}}
            <tr>
              <th {{#class}}class="{{class}}"{{/class}}>{{label}} </th>
              <td class="val">
                {{#refid}}
                <a class="ref-link{{#has_tooltip}} has-tooltip{{/has_tooltip}}"
                   {{#has_tooltip}} data-placement="right" title="{{tooltip}}"{{/has_tooltip}}
                   href="#/viewdoc/{{refid}}">
                  {{/refid}}
                  {{{val}}}
                  {{#refid}}
                </a>
                {{/refid}}
              </td>
            </tr>
            {{/data}}
            {{#hasextra}}
            <tr><th colspan="2"><a href="#" class="extra-data has-tooltip" data-placement="right" title="Show extra data">>>></a></th></tr>
            {{/hasextra}}
          </tbody>
        </table>
        {{#hasextra}}
        <table class="table small-bottom-margin hide extra-data">
          <tbody>
            {{#extradata}}
            <tr>
              <th {{#class}}class="{{class}}"{{/class}}>{{label}}</th>
              <td class="val">{{{val}}}</td>
            </tr>
            {{/extradata}}
          </tbody>
        </table>
        {{/hasextra}}
      </div>
      
      <ul class="linked-docs hide"></ul>
      
      {{#meta}}
      <div class="doc-footer">
        <p class="doc-metadata muted pull-right">
          {{#created_at}}
          Created on {{created_at}} by <b>{{created_by}}</b>{{^edited_at}}.{{/edited_at}}{{#edited_at}},{{/edited_at}}
          {{/created_at}}
          {{#edited_at}}
          last modification on {{edited_at}} by <b>{{edited_by}}</b>.
          {{/edited_at}}
          {{#edited_on}}
          on <b>{{edited_on}}</b>
          {{/edited_on}}
        </p>
      </div>
      {{/meta}}
    </div>
  </div>
  </div>
  {{/docs}}
  
